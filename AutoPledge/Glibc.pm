#!/usr/bin/perl
#
# (c)2025 Ira Parsons
# AutoPledge::Glibc - detect glibc calls from elf binary
#

package AutoPledge::Glibc;

use AutoPledge::Core ':promises';

# enumerate promises by glibc function
my %funcs = (
              __isoc23_scanf  => STDIO | TTY,
              _flushlbf => STDIO,
              _Fork => PROC,
              _tolower => 0,
              _toupper => 0,
              __fbufsize => STDIO,
              __flbf => STDIO,
              __fpending => STDIO,
              __fpurge => STDIO,
              __freadable => STDIO,
              __freading => STDIO,
              __fsetlocking => FLOCK,
              __fwritable => STDIO,
              __fwriting => STDIO,
              a64l => 0,
              abort => 0,
              accept => UNIX | INET,
              access => WPATH,
              addmntent => 0,
              addseverity => 0,
              adjtime => 0,
              adjtimex => 0,
              aio_cancel => 0,
              aio_cancel64 => 0,
              aio_error => 0,
              aio_error64 => 0,
              aio_fsync => 0,
              aio_fsync64 => 0,
              aio_init => 0,
              aio_read => 0,
              aio_read64 => 0,
              aio_return => 0,
              aio_return64 => 0,
              aio_suspend => 0,
              aio_suspend64 => 0,
              aio_write => 0,
              aio_write64 => 0,
              alarm => 0,
              aligned_alloc => 0,
              alloca => 0,
              alphasort => 0,
              alphasort64 => 0,
              arc4random => 0,
              arc4random_buf => 0,
              arc4random_uniform => 0,
              argp_error => 0,
              argp_failure => 0,
              argp_help => 0,
              argp_parse => 0,
              argp_state_help => 0,
              argp_usage => 0,
              argz_add => 0,
              argz_add_sep => 0,
              argz_append => 0,
              argz_count => 0,
              argz_create => 0,
              argz_create_sep => 0,
              argz_delete => 0,
              argz_extract => 0,
              argz_insert => 0,
              argz_next => 0,
              argz_replace => 0,
              argz_stringify => 0,
              asctime => 0,
              asctime_r => 0,
              asprintf => STDIO,
              assert => 0,
              assert_perror => 0,
              atexit => 0,
              atof => 0,
              atoi => 0,
              atol => 0,
              atoll => 0,
              backtrace => 0,
              backtrace_symbols => 0,
              backtrace_symbols_fd => 0,
              basename => 0,
              basename => 0,
              bcmp => 0,
              bcopy => 0,
              bind => UNIX | INET,
              bindtextdomain => 0,
              bind_textdomain_codeset => 0,
              brk => STDIO,
              bsearch => 0,
              btowc => 0,
              bzero => 0,
              calloc => STDIO,
              call_once => 0,
              canonicalize => 0,
              canonicalizef => 0,
              canonicalizefN => 0,
              canonicalizefNx => 0,
              canonicalizel => 0,
              canonicalize_file_name => 0,
              carg => 0,
              cargf => 0,
              cargfN => 0,
              cargfNx => 0,
              cargl => 0,
              catclose => 0,
              catgets => 0,
              catopen => 0,
              cfgetispeed => 0,
              cfgetospeed => 0,
              cfmakeraw => 0,
              cfsetispeed => 0,
              cfsetospeed => 0,
              cfsetspeed => 0,
              chdir => 0,
              chmod => FATTR,
              chmod => FATTR,
              chown => CHOWN,
              cimag => 0,
              cimagf => 0,
              cimagfN => 0,
              cimagfNx => 0,
              cimagl => 0,
              clearenv => 0,
              clearerr => 0,
              clearerr_unlocked => 0,
              clock => 0,
              clock_getres => STDIO,
              clock_gettime => STDIO,
              clock_settime => 0,
              close => STDIO,
              closedir => 0,
              closefrom => 0,
              closelog => 0,
              close_range => 0,
              cnd_broadcast => 0,
              cnd_destroy => 0,
              cnd_init => 0,
              cnd_signal => 0,
              cnd_timedwait => 0,
              cnd_wait => 0,
              confstr => 0,
              conj => 0,
              conjf => 0,
              conjfN => 0,
              conjfNx => 0,
              conjl => 0,
              connect => UNIX | DNS | INET,
              continue => 0,
              copysign => 0,
              copysignf => 0,
              copysignfN => 0,
              copysignfNx => 0,
              copysignl => 0,
              copy_file_range => 0,
              cproj => 0,
              cprojf => 0,
              cprojfN => 0,
              cprojfNx => 0,
              cprojl => 0,
              creal => 0,
              crealf => 0,
              crealfN => 0,
              crealfNx => 0,
              creall => 0,
              creat => 0,
              creat64 => 0,
              crypt => 0,
              crypt_r => 0,
              ctermid => 0,
              ctime => 0,
              ctime_r => 0,
              cuserid => 0,
              dcgettext => 0,
              dcngettext => 0,
              dgettext => 0,
              difftime => 0,
              dirfd => 0,
              dirname => 0,
              div => 0,
              dlinfo => 0,
              dngettext => 0,
              drand48 => 0,
              drand48_r => 0,
              DTTOIF => 0,
              dup => STDIO,
              dup2 => STDIO,
              endfsent => 0,
              endgrent => 0,
              endhostent => 0,
              endmntent => 0,
              endnetent => 0,
              endnetgrent => 0,
              endprotoent => 0,
              endpwent => 0,
              endservent => 0,
              endutent => 0,
              endutxent => 0,
              envz_add => 0,
              envz_entry => 0,
              envz_get => 0,
              envz_merge => 0,
              envz_remove => 0,
              envz_strip => 0,
              erand48 => 0,
              erand48_r => 0,
              err => 0,
              error => 0,
              error_at_line => 0,
              errx => 0,
              execl => EXEC,
              execle => EXEC,
              execlp => EXEC,
              execv => EXEC,
              execve => EXEC,
              execvp => EXEC,
              exit => 0,
              explicit_bzero => 0,
              fchdir => STDIO,
              fchmod => FATTR,
              fchown => CHOWN,
              fclose => STDIO,
              fcloseall => STDIO,
              fcntl => STDIO,
              fdatasync => STDIO,
              fdopen => RPATH,
              fdopendir => RPATH,
              FD_CLR => 0,
              FD_ISSET => 0,
              FD_SET => 0,
              FD_ZERO => 0,
              feclearexcept => 0,
              fedisableexcept => 0,
              feenableexcept => 0,
              fegetenv => 0,
              fegetexcept => 0,
              fegetexceptflag => 0,
              fegetmode => 0,
              fegetround => 0,
              feholdexcept => 0,
              feof => RPATH,
              feof_unlocked => RPATH,
              feraiseexcept => 0,
              ferror => RPATH,
              ferror_unlocked => RPATH,
              fesetenv => 0,
              fesetexcept => 0,
              fesetexceptflag => 0,
              fesetmode => 0,
              fesetround => 0,
              fetestexcept => 0,
              fetestexceptflag => 0,
              feupdateenv => 0,
              fexecve => EXEC,
              fflush => STDIO,
              fflush_unlocked => STDIO,
              fgetc => STDIO,
              fgetc_unlocked => STDIO,
              fgetgrent => 0,
              fgetgrent_r => 0,
              fgetpos => RPATH,
              fgetpos64 => RPATH,
              fgetpwent => 0,
              fgetpwent_r => 0,
              fgets => STDIO,
              fgets_unlocked => STDIO,
              fgetwc => STDIO,
              fgetwc_unlocked => STDIO,
              fgetws => STDIO,
              fgetws_unlocked => STDIO,
              fileno => 0,
              fileno_unlocked => 0,
              flockfile => FLOCK,
              fmemopen => 0,
              fmtmsg => 0,
              fnmatch => 0,
              fopen => STDIO,
              fopen64 => STDIO,
              fopencookie => STDIO,
              fork => PROC,
              forkpty => 0,
              fpathconf => 0,
              fprintf => STDIO | WPATH,
              fputc => WPATH,
              fputc_unlocked => WPATH,
              fputs => WPATH,
              fputs_unlocked => WPATH,
              fputwc => WPATH,
              fputwc_unlocked => WPATH,
              fputws => WPATH,
              fputws_unlocked => WPATH,
              fread => STDIO,
              fread_unlocked => STDIO,
              free => STDIO,
              freopen => STDIO,
              freopen64 => STDIO,
              fscanf => STDIO | RPATH,
              fseek => RPATH,
              fseeko => RPATH,
              fseeko64 => RPATH,
              fsetpos => RPATH,
              fsetpos64 => RPATH,
              fstat => STDIO,
              fstat64 => STDIO,
              fsync => STDIO,
              ftell => RPATH,
              ftello => RPATH,
              ftello64 => RPATH,
              ftruncate => STDIO,
              ftruncate64 => STDIO,
              ftrylockfile => FLOCK,
              ftw => 0,
              ftw64 => 0,
              funlockfile => FLOCK,
              futimes => FATTR,
              fwide => 0,
              fwprintf => STDIO,
              fwrite => STDIO,
              fwrite_unlocked => STDIO,
              fwscanf => STDIO,
              getauxval => 0,
              getc => STDIO,
              getchar => STDIO,
              getchar_unlocked => STDIO,
              getcontext => 0,
              getcwd => WPATH,
              getc_unlocked => STDIO,
              getdate => 0,
              getdate_r => 0,
              getdelim => STDIO,
              getdents64 => STDIO,
              getdomainnname => 0,
              getegid => STDIO,
              getentropy => 0,
              getenv => 0,
              geteuid => STDIO,
              getfsent => 0,
              getfsfile => 0,
              getfsspec => 0,
              getgid => STDIO,
              getgrent => 0,
              getgrent_r => 0,
              getgrgid => 0,
              getgrgid_r => 0,
              getgrnam => 0,
              getgrnam_r => 0,
              getgrouplist => 0,
              getgroups => STDIO,
              gethostbyaddr => 0,
              gethostbyaddr_r => 0,
              gethostbyname => 0,
              gethostbyname2 => 0,
              gethostbyname2_r => 0,
              gethostbyname_r => 0,
              gethostent => 0,
              gethostid => 0,
              gethostname => 0,
              getitimer => STDIO,
              getline => STDIO,
              getloadavg => 0,
              getlogin => 0,
              getmntent => 0,
              getmntent_r => 0,
              getnetbyaddr => 0,
              getnetbyname => 0,
              getnetent => 0,
              getnetgrent => 0,
              getnetgrent_r => 0,
              getopt => 0,
              getopt_long => 0,
              getopt_long_only => 0,
              getpagesize => 0,
              getpass => 0,
              getpayload => 0,
              getpayloadf => 0,
              getpayloadfN => 0,
              getpayloadfNx => 0,
              getpayloadl => 0,
              getpeername => UNIX | INET,
              getpgid => STDIO,
              getpgrp => STDIO,
              getpid => STDIO,
              getppid => STDIO,
              getpriority => PROC,
              getprotobyname => 0,
              getprotobynumber => 0,
              getprotoent => 0,
              getpt => 0,
              getpwent => 0,
              getpwent_r => 0,
              getpwnam => 0,
              getpwnam_r => 0,
              getpwuid => 0,
              getpwuid_r => 0,
              getrandom => STDIO,
              getrlimit => STDIO,
              getrlimit64 => STDIO,
              getrusage => 0,
              gets => STDIO,
              getservbyname => 0,
              getservbyport => 0,
              getservent => 0,
              getsid => STDIO,
              getsockname => UNIX | INET,
              getsockopt => UNIX | INET,
              getsubopt => 0,
              gettext => 0,
              gettid => 0,
              gettimeofday => STDIO,
              getuid => STDIO,
              getumask => 0,
              getutent => 0,
              getutent_r => 0,
              getutid => 0,
              getutid_r => 0,
              getutline => 0,
              getutline_r => 0,
              getutmp => 0,
              getutmpx => 0,
              getutxent => 0,
              getutxid => 0,
              getutxline => 0,
              getw => STDIO,
              getwc => STDIO,
              getwchar => STDIO,
              getwchar_unlocked => STDIO,
              getwc_unlocked => STDIO,
              getwd => 0,
              get_avphys_pages => 0,
              get_current_dir_name => 0,
              get_nprocs => 0,
              get_nprocs_conf => 0,
              get_phys_pages => 0,
              glob => 0,
              glob64 => 0,
              globfree => 0,
              globfree64 => 0,
              gmtime => 0,
              gmtime_r => 0,
              grantpt => 0,
              grantpt => 0,
              gsignal => 0,
              gtty => 0,
              hasmntopt => 0,
              hcreate => 0,
              hcreate_r => 0,
              hdestroy => 0,
              hdestroy_r => 0,
              hsearch => 0,
              hsearch_r => 0,
              htonl => 0,
              htons => 0,
              iconv => 0,
              iconv_close => 0,
              iconv_open => 0,
              IFTODT => 0,
              if_freenameindex => 0,
              if_indextoname => 0,
              if_nameindex => 0,
              if_nametoindex => 0,
              imaxdiv => 0,
              index => 0,
              inet_addr => 0,
              inet_aton => 0,
              inet_lnaof => 0,
              inet_makeaddr => 0,
              inet_netof => 0,
              inet_network => 0,
              inet_ntoa => 0,
              inet_ntop => 0,
              inet_pton => 0,
              initgroups => 0,
              initstate => 0,
              initstate_r => 0,
              innetgr => 0,
              ioctl => STDIO,
              isalnum => 0,
              isalpha => 0,
              isascii => 0,
              isatty => 0,
              isblank => 0,
              iscntrl => 0,
              isdigit => 0,
              iseqsig => 0,
              isgraph => 0,
              isgreater => 0,
              isgreaterequal => 0,
              isless => 0,
              islessequal => 0,
              islessgreater => 0,
              islower => 0,
              isprint => 0,
              ispunct => 0,
              isspace => 0,
              isunordered => 0,
              isupper => 0,
              iswalnum => 0,
              iswalpha => 0,
              iswblank => 0,
              iswcntrl => 0,
              iswctype => 0,
              iswdigit => 0,
              iswgraph => 0,
              iswlower => 0,
              iswprint => 0,
              iswpunct => 0,
              iswspace => 0,
              iswupper => 0,
              iswxdigit => 0,
              isxdigit => 0,
              jrand48 => 0,
              jrand48_r => 0,
              kill => PROC,
              killpg => PROC,
              l64a => 0,
              lcong48 => 0,
              lcong48_r => 0,
              lfind => 0,
              link => CPATH,
              linkat => CPATH,
              lio_listio => 0,
              lio_listio64 => 0,
              listen => UNIX | INET,
              localeconv => 0,
              localtime => 0,
              localtime_r => 0,
              login => 0,
              login_tty => 0,
              logout => 0,
              logwtmp => 0,
              longjmp => 0,
              lrand48 => 0,
              lrand48_r => 0,
              lsearch => 0,
              lseek => STDIO,
              lseek64 => STDIO,
              lstat => TMPPATH,
              lstat64 => TMPPATH,
              lutimes => FATTR,
              madvise => STDIO,
              main => 0,
              makecontext => 0,
              mallinfo2 => 0,
              malloc => STDIO,
              mallopt => 0,
              mblen => 0,
              mbrlen => 0,
              mbrtowc => 0,
              mbsinit => 0,
              mbsnrtowcs => 0,
              mbsrtowcs => 0,
              mbstowcs => 0,
              mbtowc => 0,
              mcheck => 0,
              memalign => 0,
              memccpy => 0,
              memchr => 0,
              memcmp => 0,
              memcpy => 0,
              memfd_create => 0,
              memfrob => 0,
              memmem => 0,
              memmove => 0,
              mempcpy => 0,
              memrchr => 0,
              memset => 0,
              merge => 0,
              mkdir => CPATH,
              mkdtemp => TMPPATH,
              mkfifo => DPATH,
              mknod => DPATH,
              mkstemp => TMPPATH,
              mktemp => TMPPATH,
              mktime => 0,
              mlock => 0,
              mlock2 => 0,
              mlockall => 0,
              mmap => STDIO,
              mmap64 => STDIO,
              mount => 0,
              mprobe => 0,
              mprotect => STDIO,
              mrand48 => 0,
              mrand48_r => 0,
              mremap => STDIO,
              msync => STDIO,
              mtrace => 0,
              mtx_destroy => 0,
              mtx_init => 0,
              mtx_lock => 0,
              mtx_timedlock => 0,
              mtx_trylock => 0,
              mtx_unlock => 0,
              munlock => 0,
              munlockall => 0,
              munmap => STDIO,
              muntrace => STDIO,
              nan => 0,
              nanf => 0,
              nanfN => 0,
              nanfNx => 0,
              nanl => 0,
              nanosleep => STDIO,
              nextafter => 0,
              nextafterf => 0,
              nextafterfN => 0,
              nextafterfNx => 0,
              nextafterl => 0,
              nextdown => 0,
              nextdownf => 0,
              nextdownfN => 0,
              nextdownfNx => 0,
              nextdownl => 0,
              nexttoward => 0,
              nexttowardf => 0,
              nexttowardl => 0,
              nextup => 0,
              nextupf => 0,
              nextupfN => 0,
              nextupfNx => 0,
              nextupl => 0,
              nftw => 0,
              nftw64 => 0,
              ngettext => 0,
              nice => ID,
              nl_langinfo => 0,
              notfound => 0,
              nrand48 => 0,
              nrand48_r => 0,
              ntohl => 0,
              ntohs => 0,
              ntp_adjtime => 0,
              ntp_gettime => 0,
              obstack_1grow => 0,
              obstack_1grow_fast => 0,
              obstack_alignment_mask => 0,
              obstack_alloc => 0,
              obstack_base => 0,
              obstack_blank => 0,
              obstack_blank_fast => 0,
              obstack_chunk_alloc => 0,
              obstack_chunk_free => 0,
              obstack_chunk_size => 0,
              obstack_copy => 0,
              obstack_copy0 => 0,
              obstack_finish => 0,
              obstack_free => 0,
              obstack_grow => 0,
              obstack_grow0 => 0,
              obstack_init => 0,
              obstack_int_grow => 0,
              obstack_int_grow_fast => 0,
              obstack_next_free => 0,
              obstack_object_size => 0,
              obstack_object_size => 0,
              obstack_printf => STDIO,
              obstack_ptr_grow => 0,
              obstack_ptr_grow_fast => 0,
              obstack_room => 0,
              obstack_vprintf => STDIO,
              offsetof => 0,
              on_exit => 0,
              open => RPATH,
              open64 => RPATH,
              opendir => 0,
              openlog => 0,
              openpty => 0,
              open_memstream => 0,
              parse_printf_format => STDIO,
              pathconf => 0,
              pause => 0,
              pclose => 0,
              perror => 0,
              pipe => STDIO,
              pkey_alloc => STDIO,
              pkey_free => STDIO,
              pkey_get => STDIO,
              pkey_mprotect => STDIO,
              pkey_set => STDIO,
              popen => STDIO,
              posix_fallocate => STDIO,
              posix_fallocate64 => STDIO,
              posix_memalign => STDIO,
              posix_openpt => STDIO,
              pread => STDIO,
              pread64 => STDIO,
              preadv => STDIO,
              preadv2 => STDIO,
              preadv64 => STDIO,
              preadv64v2 => STDIO,
              printf => STDIO | TTY,
              psignal => 0,
              pthread_attr_getsigmask_np => THREAD,
              pthread_attr_setsigmask_np => THREAD,
              pthread_clockjoin_np => THREAD,
              pthread_cond_clockwait => THREAD,
              pthread_getattr_default_np => THREAD,
              pthread_key_create => THREAD,
              pthread_key_delete => THREAD,
              pthread_rwlock_clockrdlock => THREAD,
              pthread_rwlock_clockwrlock => THREAD,
              pthread_setattr_default_np => THREAD,
              pthread_setspecific => THREAD,
              pthread_timedjoin_np => THREAD,
              pthread_tryjoin_np => THREAD,
              ptsname => 0,
              ptsname_r => 0,
              putc => STDIO,
              putchar => STDIO,
              putchar_unlocked => STDIO,
              putc_unlocked => STDIO,
              putenv => 0,
              putpwent => 0,
              puts => STDIO,
              pututline => 0,
              pututxline => 0,
              putw => STDIO,
              putwc => STDIO,
              putwchar => STDIO,
              putwchar_unlocked => STDIO,
              putwc_unlocked => STDIO,
              pwrite => STDIO,
              pwrite64 => STDIO,
              pwritev => STDIO,
              pwritev2 => STDIO,
              pwritev64 => STDIO,
              pwritev64v2 => STDIO,
              qsort => 0,
              raise => 0,
              rand => 0,
              random => 0,
              random_r => 0,
              rand_r => 0,
              rawmemchr => 0,
              read => STDIO,
              readdir => 0,
              readdir64 => 0,
              readdir64_r => 0,
              readdir_r => 0,
              readlink => WPATH,
              readv => STDIO,
              realloc => STDIO,
              reallocarray => STDIO,
              realpath => 0,
              recv => STDIO,
              recvfrom => STDIO,
              regcomp => 0,
              regerror => 0,
              regexec => 0,
              regfree => 0,
              remove => WPATH,
              rename => CPATH,
              return => 0,
              rewind => RPATH,
              rewinddir => 0,
              rindex => 0,
              rmdir => CPATH,
              rpmatch => 0,
              scandir => 0,
              scandir64 => 0,
              scanf => STDIO,
              sched_getparam => PROC,
              sched_getscheduler => PROC,
              sched_get_priority_max => PROC,
              sched_get_priority_min => PROC,
              sched_rr_get_interval => PROC,
              sched_setparam => PROC,
              sched_setscheduler => PROC,
              sched_yield => PROC,
              secure_getenv => 0,
              seed48 => 0,
              seed48_r => 0,
              seekdir => 0,
              select => STDIO,
              semctl => 0,
              semget => 0,
              semop => 0,
              semtimedop => 0,
              sem_clockwait => 0,
              sem_close => 0,
              sem_destroy => 0,
              sem_getvalue => 0,
              sem_init => 0,
              sem_post => 0,
              sem_timedwait => 0,
              sem_trywait => 0,
              sem_unlink => 0,
              sem_wait => 0,
              send => STDIO,
              sendto => STDIO,
              setbuf => 0,
              setbuffer => 0,
              setcontext => 0,
              setdomainname => 0,
              setegid => ID,
              setenv => 0,
              seteuid => ID,
              setfsent => 0,
              setgid => ID,
              setgrent => 0,
              setgroups => ID,
              sethostent => 0,
              sethostid => 0,
              sethostname => 0,
              setitimer => STDIO,
              setjmp => 0,
              setlinebuf => 0,
              setlocale => 0,
              setlogmask => 0,
              setmntent => 0,
              setnetent => 0,
              setnetgrent => 0,
              setpayload => 0,
              setpayloadf => 0,
              setpayloadfN => 0,
              setpayloadfNx => 0,
              setpayloadl => 0,
              setpayloadsig => 0,
              setpayloadsigf => 0,
              setpayloadsigfN => 0,
              setpayloadsigfNx => 0,
              setpayloadsigl => 0,
              setpgid => PROC,
              setpgrp => PROC,
              setpriority => PROC,
              setprotoent => 0,
              setpwent => 0,
              setregid => ID,
              setreuid => ID,
              setrlimit => PROC,
              setrlimit64 => PROC,
              setservent => 0,
              setsid => PROC,
              setsockopt => UNIX | INET,
              setstate => 0,
              setstate_r => 0,
              settimeofday => 0,
              setuid => ID,
              setutent => 0,
              setutxent => 0,
              setvbuf => 0,
              shm_open => 0,
              shm_unlink => 0,
              shutdown => STDIO,
              sigabbrev_np => 0,
              sigaction => STDIO,
              sigaddset => 0,
              sigaltstack => STDIO,
              sigblock => 0,
              sigdelset => 0,
              sigdescr_np => 0,
              sigemptyset => 0,
              sigfillset => 0,
              siginterrupt => 0,
              sigismember => 0,
              siglongjmp => 0,
              sigmask => 0,
              signal => 0,
              signbit => 0,
              sigpause => 0,
              sigpending => 0,
              sigprocmask => 0,
              sigsetjmp => 0,
              sigsetmask => 0,
              sigstack => STDIO,
              sigsuspend => STDIO,
              sleep => 0,
              snprintf => STDIO,
              socket => UNIX | DNS | INET,
              socketpair => STDIO,
              sprintf => STDIO,
              srand => 0,
              srand48 => 0,
              srand48_r => 0,
              srandom => 0,
              srandom_r => 0,
              sscanf => STDIO,
              ssignal => 0,
              stat => WPATH,
              stat64 => WPATH,
              stime => 0,
              stpcpy => 0,
              stpncpy => 0,
              strcasecmp => 0,
              strcasestr => 0,
              strcat => 0,
              strchr => 0,
              strchrnul => 0,
              strcmp => 0,
              strcoll => 0,
              strcpy => 0,
              strcspn => 0,
              strdup => 0,
              strdupa => 0,
              strerror => 0,
              strerrordesc_np => 0,
              strerrorname_np => 0,
              strerror_l => 0,
              strerror_r => 0,
              strerror_r => 0,
              strfmon => 0,
              strfromd => 0,
              strfromf => 0,
              strfromfN => 0,
              strfromfNx => 0,
              strfroml => 0,
              strfry => 0,
              strftime => 0,
              strlcat => 0,
              strlcpy => 0,
              strlen => 0,
              strncasecmp => 0,
              strncat => 0,
              strncmp => 0,
              strncpy => 0,
              strndup => 0,
              strndupa => 0,
              strnlen => 0,
              strpbrk => 0,
              strptime => 0,
              strrchr => 0,
              strsep => 0,
              strsignal => 0,
              strspn => 0,
              strstr => 0,
              strtod => 0,
              strtof => 0,
              strtofN => 0,
              strtofNx => 0,
              strtoimax => 0,
              strtok => 0,
              strtok_r => 0,
              strtol => 0,
              strtold => 0,
              strtoll => 0,
              strtoq => 0,
              strtoul => 0,
              strtoull => 0,
              strtoumax => 0,
              strtouq => 0,
              strverscmp => 0,
              strxfrm => 0,
              stty => 0,
              success => 0,
              SUN_LEN => 0,
              swapcontext => 0,
              swprintf => STDIO,
              swscanf => STDIO,
              symlink => CPATH,
              sync => 0,
              syscall => 0,
              sysconf => 0,
              syslog => 0,
              system => 0,
              sysv_signal => 0,
              S_ISBLK => 0,
              S_ISCHR => 0,
              S_ISDIR => 0,
              S_ISFIFO => 0,
              S_ISLNK => 0,
              S_ISREG => 0,
              S_ISSOCK => 0,
              S_TYPEISMQ => 0,
              S_TYPEISSEM => 0,
              S_TYPEISSHM => 0,
              tcdrain => TTY,
              tcflow => TTY,
              tcflush => TTY,
              tcgetattr => TTY,
              tcgetpgrp => TTY,
              tcgetsid => TTY,
              tcsendbreak => TTY,
              tcsetattr => TTY,
              tcsetpgrp => TTY,
              tdelete => 0,
              tdestroy => 0,
              telldir => 0,
              tempnam => TMPPATH,
              TEMP_FAILURE_RETRY => 0,
              textdomain => 0,
              tfind => 0,
              tgkill => PROC,
              thrd_create => THREAD,
              thrd_current => THREAD,
              thrd_detach => THREAD,
              thrd_equal => THREAD,
              thrd_exit => THREAD,
              thrd_join => THREAD,
              thrd_sleep => THREAD,
              thrd_yield => THREAD,
              time => STDIO,
              timegm => 0,
              timelocal => 0,
              times => 0,
              tmpfile => TMPPATH,
              tmpfile64 => TMPPATH,
              tmpnam => TMPPATH,
              tmpnam_r => TMPPATH,
              toascii => 0,
              tolower => 0,
              totalorder => 0,
              totalorderf => 0,
              totalorderfN => 0,
              totalorderfNx => 0,
              totalorderl => 0,
              totalordermag => 0,
              totalordermagf => 0,
              totalordermagfN => 0,
              totalordermagfNx => 0,
              totalordermagl => 0,
              toupper => 0,
              towctrans => 0,
              towlower => 0,
              towupper => 0,
              truncate => 0,
              truncate64 => 0,
              tryagain => 0,
              tsearch => 0,
              tss_create => THREAD,
              tss_delete => THREAD,
              tss_get => THREAD,
              tss_set => THREAD,
              ttyname => 0,
              ttyname_r => 0,
              twalk => 0,
              twalk_r => 0,
              tzset => 0,
              ulimit => 0,
              umask => STDIO,
              umount => 0,
              umount2 => 0,
              uname => STDIO,
              unavail => 0,
              ungetc => 0,
              ungetwc => 0,
              unlink => TMPPATH,
              unlockpt => 0,
              unsetenv => 0,
              updwtmp => 0,
              utime => FATTR,
              utimes => FATTR,
              utmpname => 0,
              utmpxname => 0,
              valloc => 0,
              vasprintf => STDIO,
              verr => 0,
              verrx => 0,
              versionsort => 0,
              versionsort64 => 0,
              vfork => PROC,
              vfprintf => STDIO,
              vfscanf => STDIO,
              vfwprintf => STDIO,
              vfwscanf => STDIO,
              vlimit => 0,
              vprintf => STDIO,
              vscanf => STDIO,
              vsnprintf => STDIO,
              vsprintf => STDIO,
              vsscanf => STDIO,
              vswprintf => 0,
              vswscanf => STDIO,
              vsyslog => 0,
              vwarn => 0,
              vwarnx => 0,
              vwprintf => STDIO,
              vwscanf => STDIO,
              wait => STDIO,
              wait3 => STDIO,
              wait4 => STDIO,
              waitpid => STDIO,
              warn => 0,
              warnx => 0,
              WCOREDUMP => 0,
              wcpcpy => 0,
              wcpncpy => 0,
              wcrtomb => 0,
              wcscasecmp => 0,
              wcscat => 0,
              wcschr => 0,
              wcschrnul => 0,
              wcscmp => 0,
              wcscoll => 0,
              wcscpy => 0,
              wcscspn => 0,
              wcsdup => 0,
              wcsftime => 0,
              wcslcat => 0,
              wcslcpy => 0,
              wcslen => 0,
              wcsncasecmp => 0,
              wcsncat => 0,
              wcsncmp => 0,
              wcsncpy => 0,
              wcsnlen => 0,
              wcsnrtombs => 0,
              wcspbrk => 0,
              wcsrchr => 0,
              wcsrtombs => 0,
              wcsspn => 0,
              wcsstr => 0,
              wcstod => 0,
              wcstof => 0,
              wcstofN => 0,
              wcstofNx => 0,
              wcstoimax => 0,
              wcstok => 0,
              wcstol => 0,
              wcstold => 0,
              wcstoll => 0,
              wcstombs => 0,
              wcstoq => 0,
              wcstoul => 0,
              wcstoull => 0,
              wcstoumax => 0,
              wcstouq => 0,
              wcswcs => 0,
              wcsxfrm => 0,
              wctob => 0,
              wctomb => 0,
              wctrans => 0,
              wctype => 0,
              WEXITSTATUS => 0,
              WIFEXITED => 0,
              WIFSIGNALED => 0,
              WIFSTOPPED => 0,
              wmemchr => 0,
              wmemcmp => 0,
              wmemcpy => 0,
              wmemmove => 0,
              wmempcpy => 0,
              wmemset => 0,
              wordexp => 0,
              wordfree => 0,
              wprintf => STDIO,
              write => STDIO,
              writev => STDIO,
              wscanf => STDIO,
              WSTOPSIG => 0,
              WTERMSIG => 0
);

sub detect {

    # determine if program is linked to glibc
    my $yorn = `readelf -p .interp $_[0] 2>/dev/null`;
    if ($yorn !~ /\.so/) {
        return 0;
    };

    # dump symbols in .dynsym section
    my $raw = `objdump -T $_[0]`;

    # form lines into array
    my @allsyms = split("\n", $raw);

    # pull glibc calls from formatted output
    my @syms = ();
    foreach $string (@allsyms) {
        if ($string =~ /.*\(GLIBC.*\)\s*(.*)$/) {
            push(@syms, $1);
        }
    }

    # assign appropriate promises
    my $promises = 0;
    foreach $sym (@syms) {
        $promises |= $funcs{$sym} if exists $funcs{$sym};
    }

    return $promises;

}

1;
